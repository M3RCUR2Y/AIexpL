Dify 工作流设计方案：Office 文档日期统一格式化
工作流概述
本工作流旨在自动识别 Office 文档（Word、Excel、PowerPoint）中的所有日期，并将其统一格式化为 "yyyy-MM-dd hh:mm:ss" 格式。工作流将通过文档解析、日期提取、格式转换和文档重构四个主要步骤完成任务。
工作流详细设计
1. 文档上传节点
类型：输入节点
功能：接收用户上传的 Office 文档（支持.docx, .xlsx, .pptx 格式）
配置：设置文件类型限制为 Office 文档格式
2. 文档解析节点（代码节点）
功能：解析不同类型的 Office 文档，提取文本内容及日期可能出现的位置信息
Office文档解析代码
V1
创建时间：09-10 22:26
3. 日期提取节点（LLM 节点）
功能：从解析后的文本中识别并提取所有日期
提示词：
plaintext
你需要从提供的文档内容中识别并提取所有日期信息。请按照以下要求执行：

1. 仔细检查每个文本片段，找出所有表示日期和时间的内容
2. 日期可能的格式包括但不限于：
   - dd/mm/yyyy 或 dd-mm-yyyy
   - mm/dd/yyyy 或 mm-dd-yyyy
   - yyyy/mm/dd 或 yyyy-mm-dd
   - 英文日期（如 Jan 5, 2023; 5 January 2023）
   - 包含时间的日期（如 2023/12/05 14:30; 05-12-2023 2:30 PM）
   - 相对日期（如 昨天、今天、明天、上周、下个月）

3. 对于每个识别到的日期，请提供：
   - original_text: 原始文本中的日期字符串
   - position: 日期所在的位置标识
   - possible_formats: 该日期可能的格式（如 "dd/mm/yyyy"）

4. 请以JSON数组格式返回结果，不要包含任何额外解释。示例输出：
[
  {"original_text": "05/12/2023", "position": "paragraph_3", "possible_formats": ["dd/mm/yyyy", "mm/dd/yyyy"]},
  {"original_text": "Jan 15, 2024 3:30 PM", "position": "cell_sheet1_row5_col2", "possible_formats": ["MMM dd, yyyy hh:mm a"]}
]

文档内容：
{{document_parsed.content}}
4. 日期格式化节点（代码节点）
功能：将提取的日期统一格式化为 "yyyy-MM-dd hh:mm:ss" 格式
日期格式化代码
V1
创建时间：09-10 22:26
5. 文档重构节点（LLM 节点）
功能：将格式化后的日期替换回原文档内容中
提示词：
plaintext
请根据提供的日期格式化信息，将原始文档内容中的日期替换为统一格式（yyyy-MM-dd hh:mm:ss）。

操作要求：
1. 仅替换日期部分，保持文档其他内容不变
2. 严格按照position匹配要替换的内容
3. 对于格式化失败的日期，保持原始文本不变
4. 保持文档原有的结构和格式特征
5. 返回修改后的完整文档内容，不要添加额外解释

原始文档内容：
{{document_parsed.content}}

日期格式化信息：
{{formatted_dates_result.formatted_dates}}

文档类型：{{document_parsed.document_type}}
6. 文档生成节点（代码节点）
功能：根据重构后的内容生成新的 Office 文档
文档生成代码
V1
创建时间：09-10 22:26
7. 结果输出节点
类型：输出节点
功能：返回处理后的文档供用户下载
配置：设置输出为文件下载形式，文件名在原文件名后添加 "_formatted" 后缀
工作流执行流程
用户上传 Office 文档
文档解析节点读取并解析文档内容
LLM 节点从解析内容中提取所有日期及位置信息
日期格式化节点将提取的日期统一格式化为目标格式
LLM 节点根据格式化结果重构文档内容
文档生成节点根据重构内容生成新的 Office 文档
输出节点提供处理后的文档供用户下载
注意事项
对于模糊日期（如 "上个月"），系统会基于当前日期进行转换
对于无法解析的日期，将在结果中保持原样并在日志中记录
复杂格式的文档可能无法完全保留原格式，建议处理后进行人工检查
大规模文档处理可能需要调整代码中的临时文件处理逻辑
这个工作流可以直接在 Dify 平台上实现，通过连接各个节点形成完整的处理流程。根据实际使用情况，可能需要对代码和提示词进行微调以获得最佳效果。
